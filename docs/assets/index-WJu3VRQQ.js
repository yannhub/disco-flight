(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))s(t);new MutationObserver(t=>{for(const o of t)if(o.type==="childList")for(const L of o.addedNodes)L.tagName==="LINK"&&L.rel==="modulepreload"&&s(L)}).observe(document,{childList:!0,subtree:!0});function D(t){const o={};return t.integrity&&(o.integrity=t.integrity),t.referrerPolicy&&(o.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?o.credentials="include":t.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(t){if(t.ep)return;t.ep=!0;const o=D(t);fetch(t.href,o)}})();const R="/disco-flight/assets/disco-music-CF8K-ThL.mp3",$="/disco-flight/assets/explosion-BVY2a1Az.mp3",y=40,q=25,k=5,H=4,V=1500,W=.03,z=-3.5;let c="welcome",T=!1,r=0,O=0,g=0,m=!1,d=null,F=Date.now(),S=0,_=0,f=0,N=0,w=0,a,i,p;const E=new Audio(R),K=new Audio($),X=document.getElementById("welcome-screen"),Y=document.getElementById("orientation-screen"),A=document.getElementById("game-screen"),j=document.getElementById("gameover-screen"),x=document.getElementById("gameover-actions"),G=document.getElementById("start-button"),J=document.getElementById("restart-button"),v=document.getElementById("install-button"),h=document.querySelector("#sky-video"),I=document.querySelector("#copilot"),Q=document.getElementById("detection-bar"),U=document.getElementById("time-counter"),Z=document.getElementById("final-score"),P=document.createElement("div");P.id="debug-window";P.style.display="none";document.body.appendChild(P);let l;window.addEventListener("beforeinstallprompt",e=>{e.preventDefault(),l=e,v.style.display="block"});v.addEventListener("click",async()=>{if(l){l.prompt();const{outcome:e}=await l.userChoice;e==="accepted"&&console.log("Application installée"),l=null,v.style.display="none"}});window.addEventListener("appinstalled",()=>{console.log("Application installée avec succès"),v.style.display="none",l=null});function u(e){[X,Y,A,j].forEach(n=>{n.classList.add("hidden")}),document.getElementById(e).classList.remove("hidden")}function B(){var e;return window.innerHeight>window.innerWidth?(T=!1,c==="playing"&&(u("orientation-screen"),C(),h.pause(),a&&i.stop()),!1):(T=!0,((e=document.getElementById("orientation-screen"))==null?void 0:e.classList.contains("hidden"))===!1&&(c==="playing"?(u("game-screen"),h.play(),a&&(i=a.createOscillator(),i.connect(p),i.type="sawtooth",i.start()),f=performance.now(),M(f)):u(c==="welcome"?"welcome-screen":"gameover-screen")),!0)}function ee(){const e=g/q*100;Q.style.setProperty("--detection-percentage",`${e}%`)}function te(){if(m){d&&clearTimeout(d),d=window.setTimeout(()=>{C()},k*1e3);return}m=!0,A.classList.add("disco-mode"),E.currentTime=_,E.play()}function C(){m&&(m=!1,A.classList.remove("disco-mode"),_=E.currentTime,E.pause(),d&&(clearTimeout(d),d=null))}function ne(){i.frequency.value=100+r/y*50}function oe(){const e=Date.now();e-F>V&&(O=Math.random()*y*2-y,F=e),r+=(O-r)*W}function ie(){const e=Math.abs(r)/y,n=H*e;let s=parseFloat(I.style.left)||50;if(r!==0){const t=r>0?1:-1;s+=t*n}if(S!==0){const t=S/y*z;s-=t}s=Math.max(10,Math.min(90,s)),I.style.left=`${s}%`,(s<=10||s>=90)&&te()}function M(e){if(c==="playing"&&T){const n=(e-f)/1e3;n>=1/60&&(f=e,w=(e-N)/100,U.textContent=w.toFixed(0),oe(),ie(),ne(),m&&(g+=n),ee(),g>=q&&(c="gameover",re()),h.style.transform=`rotate(${-r}deg)`),requestAnimationFrame(M)}}function se(e){c==="playing"&&(S=e.beta||0)}function ce(){const e=document.documentElement;e.requestFullscreen&&e.requestFullscreen()}function b(){c="playing",g=0,r=0,O=0,m=!1,f=performance.now(),N=f,w=0,a=new AudioContext,i=a.createOscillator(),p=a.createGain(),i.connect(p),p.connect(a.destination),i.type="sawtooth",p.gain.value=.1,x.classList.add("hidden"),I.style.left="50%",u("game-screen"),h.play(),i.start(),ce(),B(),requestAnimationFrame(M)}function re(){c="gameover",Z.textContent=`Score: ${w.toFixed(2)}`,u("gameover-screen"),C(),i.stop(),K.play(),setTimeout(()=>{x.classList.remove("hidden")},1e3)}G.addEventListener("click",b);J.addEventListener("click",b);window.addEventListener("orientationchange",()=>{setTimeout(B,100)});window.addEventListener("resize",()=>{setTimeout(B,100)});window.addEventListener("deviceorientation",se);document.addEventListener("DOMContentLoaded",()=>{u("welcome-screen"),typeof DeviceOrientationEvent.requestPermission=="function"&&G.addEventListener("click",async()=>{try{await DeviceOrientationEvent.requestPermission()==="granted"&&b()}catch(e){console.error("Permission denied:",e)}})});
//# sourceMappingURL=index-WJu3VRQQ.js.map
