(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))o(t);new MutationObserver(t=>{for(const i of t)if(i.type==="childList")for(const O of i.addedNodes)O.tagName==="LINK"&&O.rel==="modulepreload"&&o(O)}).observe(document,{childList:!0,subtree:!0});function E(t){const i={};return t.integrity&&(i.integrity=t.integrity),t.referrerPolicy&&(i.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?i.credentials="include":t.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function o(t){if(t.ep)return;t.ep=!0;const i=E(t);fetch(t.href,i)}})();const z="/disco-flight/assets/disco-music-CF8K-ThL.mp3",H="/disco-flight/assets/explosion-BVY2a1Az.mp3",w=45,_=20,$=3,V=3,W=1500,Y=.15,D=.01,K=-3;let c="welcome",I=!1,r=0,S=0,h=0,m=!1,d=null,R=Date.now(),y=0,N=0,f=0,x=0,v=0,a,s,g;const p=new Audio(z),M=new Audio(H),X=document.getElementById("welcome-screen"),Q=document.getElementById("orientation-screen"),A=document.getElementById("game-screen"),j=document.getElementById("gameover-screen"),G=document.getElementById("gameover-actions"),k=document.getElementById("start-button"),J=document.getElementById("restart-button"),T=document.getElementById("install-button"),L=document.querySelector("#sky-video"),P=document.querySelector("#copilot"),U=document.getElementById("detection-bar"),Z=document.getElementById("time-counter"),ee=document.getElementById("final-score"),F=document.createElement("div");F.id="debug-window";F.style.display="none";document.body.appendChild(F);let l;window.addEventListener("beforeinstallprompt",e=>{e.preventDefault(),l=e,T.style.display="block"});T.addEventListener("click",async()=>{if(l){l.prompt();const{outcome:e}=await l.userChoice;e==="accepted"&&console.log("Application installée"),l=null,T.style.display="none"}});window.addEventListener("appinstalled",()=>{console.log("Application installée avec succès"),T.style.display="none",l=null});function u(e){[X,Q,A,j].forEach(n=>{n.classList.add("hidden")}),document.getElementById(e).classList.remove("hidden")}function b(){var e;return window.innerHeight>window.innerWidth?(I=!1,c==="playing"&&(u("orientation-screen"),q(),L.pause(),a&&s.stop()),!1):(I=!0,((e=document.getElementById("orientation-screen"))==null?void 0:e.classList.contains("hidden"))===!1&&(c==="playing"?(u("game-screen"),L.play(),a&&(s=a.createOscillator(),s.connect(g),s.type="sawtooth",s.start()),f=performance.now(),B(f)):u(c==="welcome"?"welcome-screen":"gameover-screen")),!0)}function te(){const e=h/_*100;U.style.setProperty("--detection-percentage",`${e}%`)}function ne(){if(navigator.vibrate(200),m){d&&clearTimeout(d),d=window.setTimeout(()=>{q()},$*1e3);return}m=!0,A.classList.add("disco-mode"),p.currentTime=N,p.play()}function q(){m&&(m=!1,A.classList.remove("disco-mode"),N=p.currentTime,p.pause(),d&&(clearTimeout(d),d=null))}function oe(){s.frequency.value=100+r/w*50}function ie(e){return e<.5?2*e*e:-1+(4-2*e)*e}function se(){const e=Date.now();e-R>W&&(S=Math.random()*w*2-w,R=e);const n=Y;r+=(S-r)*ie(n)}function ce(){const e=Math.abs(r)/w,n=V*e;let o=parseFloat(P.style.left)||50;if(r!==0){const t=r>0?1:-1;o+=t*n}if(y!==0){const t=y/w*K;o-=t}o=Math.max(10,Math.min(90,o)),P.style.left=`${o}%`,(o<=13||o>=87)&&ne()}function B(e){if(c==="playing"&&I){const n=(e-f)/1e3;n>=1/60&&(f=e,v=(e-x)/100,Z.textContent=v.toFixed(0),se(),ce(),oe(),m&&(h+=n),te(),h>=_&&(c="gameover",le()),L.style.transform=`rotate(${-r}deg)`),requestAnimationFrame(B)}}function re(e){if(c==="playing"){y=e.beta||0;const n=e.beta||0,E=e.gamma||0,t=Math.atan2(Math.sin(E*Math.PI/180),Math.tan(n*Math.PI/180))*180/Math.PI;y=y*(1-D)+t*D}}function ae(){const e=document.documentElement;e.requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.msRequestFullscreen&&e.msRequestFullscreen()}function C(){c="playing",h=0,r=0,S=0,m=!1,f=performance.now(),x=f,v=0,a=new AudioContext,s=a.createOscillator(),g=a.createGain(),s.connect(g),g.connect(a.destination),s.type="sawtooth",g.gain.value=.1,p.play(),p.pause(),M.play(),M.pause(),G.classList.add("hidden"),P.style.left="50%",u("game-screen"),L.play(),s.start(),ae(),b(),requestAnimationFrame(B)}function le(){c="gameover",ee.textContent=`Score: ${v.toFixed(2)}`,u("gameover-screen"),q(),s.stop(),M.play(),setTimeout(()=>{G.classList.remove("hidden")},1e3)}k.addEventListener("click",C);J.addEventListener("click",C);window.addEventListener("orientationchange",()=>{setTimeout(b,100)});window.addEventListener("resize",()=>{setTimeout(b,100)});window.addEventListener("deviceorientation",re);document.addEventListener("DOMContentLoaded",()=>{u("welcome-screen"),typeof DeviceOrientationEvent.requestPermission=="function"&&k.addEventListener("click",async()=>{try{await DeviceOrientationEvent.requestPermission()==="granted"&&C()}catch(e){console.error("Permission denied:",e)}})});
//# sourceMappingURL=index-CZqfM20B.js.map
