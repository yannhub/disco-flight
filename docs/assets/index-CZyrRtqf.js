(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))n(t);new MutationObserver(t=>{for(const o of t)if(o.type==="childList")for(const O of o.addedNodes)O.tagName==="LINK"&&O.rel==="modulepreload"&&n(O)}).observe(document,{childList:!0,subtree:!0});function E(t){const o={};return t.integrity&&(o.integrity=t.integrity),t.referrerPolicy&&(o.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?o.credentials="include":t.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(t){if(t.ep)return;t.ep=!0;const o=E(t);fetch(t.href,o)}})();const j="/disco-flight/assets/disco-music-CF8K-ThL.mp3",J="/disco-flight/assets/explosion-BVY2a1Az.mp3",y=45,z=15,Q=3,U=2.5,Z=1e3,M=20,x=.01,ee=-3,te=.5;let c="welcome",P=!1,s=0,v=0,S=M,h=0,m=!1,a=null,N=Date.now(),g=0,H=0,f=0,L=0,$=0,T=0,d,l,w;const p=new Audio(j),A=new Audio(J),ne=document.getElementById("welcome-screen"),oe=document.getElementById("orientation-screen"),B=document.getElementById("game-screen"),ie=document.getElementById("gameover-screen"),V=document.getElementById("gameover-actions"),W=document.getElementById("start-button"),se=document.getElementById("restart-button"),F=document.getElementById("install-button"),I=document.querySelector("#sky-video"),b=document.querySelector("#copilot"),ce=document.getElementById("detection-bar"),le=document.getElementById("time-counter"),re=document.getElementById("final-score"),q=document.createElement("div");q.id="debug-window";q.style.display="none";document.body.appendChild(q);let r;window.addEventListener("beforeinstallprompt",e=>{e.preventDefault(),r=e,F.style.display="block"});F.addEventListener("click",async()=>{if(r){r.prompt();const{outcome:e}=await r.userChoice;e==="accepted"&&console.log("Application installée"),r=null,F.style.display="none"}});window.addEventListener("appinstalled",()=>{console.log("Application installée avec succès"),F.style.display="none",r=null});function u(e){[ne,oe,B,ie].forEach(i=>{i.classList.add("hidden")}),document.getElementById(e).classList.remove("hidden")}function C(){var e;return window.innerHeight>window.innerWidth?(P=!1,c==="playing"&&(u("orientation-screen"),_(),I.pause(),d&&l.stop()),!1):(P=!0,((e=document.getElementById("orientation-screen"))==null?void 0:e.classList.contains("hidden"))===!1&&(c==="playing"?(u("game-screen"),I.play(),d&&(X(),l.start()),f=performance.now(),D(f)):u(c==="welcome"?"welcome-screen":"gameover-screen")),!0)}function ae(){m&&(h+=L);const e=h/z*100;ce.style.setProperty("--detection-percentage",`${e}%`)}function de(){if(navigator.vibrate&&navigator.vibrate(200),m){a&&clearTimeout(a),a=window.setTimeout(()=>{_()},Q*1e3);return}m=!0,B.classList.add("disco-mode"),p.currentTime=H,p.play()}function _(){m&&(m=!1,B.classList.remove("disco-mode"),H=p.currentTime,p.pause(),a&&(clearTimeout(a),a=null))}function ue(){l.frequency.value=100+s/y*50}function me(){const e=Date.now();e-N>Z&&(v=Math.random()*y*2-y,N=e,S=Math.random()*M+M),Math.abs(v-s)>te&&(v>s?s+=L*S:s-=L*S),I.style.transform=`rotate(${-s}deg)`}function fe(){const e=Math.abs(s)/y,i=U*e;let n=parseFloat(b.style.left)||50;if(s!==0){const t=s>0?1:-1;n+=t*i}if(g!==0){const t=g/y*ee;n-=t}n=Math.max(10,Math.min(90,n)),b.style.left=`${n}%`,(n<=13||n>=87)&&de()}function D(e){c==="playing"&&P&&(L=(e-f)/1e3,f=e,T=(e-$)/100,le.textContent=T.toFixed(0),me(),fe(),ue(),ae(),h>=z&&(c="gameover",ye()),requestAnimationFrame(D))}function pe(e){if(c==="playing"){g=e.beta||0;const i=e.beta||0,E=e.gamma||0,t=Math.atan2(Math.sin(E*Math.PI/180),Math.tan(i*Math.PI/180))*180/Math.PI;g=g*(1-x)+t*x}}function Y(){const e=document.documentElement;e.requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.msRequestFullscreen&&e.msRequestFullscreen()}function ge(){document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen()}function K(){document.fullscreenElement?ge():Y()}var k;(k=document.getElementById("toggle-fullscreen-orientation"))==null||k.addEventListener("click",K);var G;(G=document.getElementById("toggle-fullscreen-gameover"))==null||G.addEventListener("click",K);function R(){c="playing",h=0,s=0,v=0,m=!1,f=performance.now(),$=f,T=0,d=new AudioContext,w=d.createGain(),w.connect(d.destination),w.gain.value=.1,X(),p.play(),p.pause(),A.play(),A.pause(),V.classList.add("hidden"),b.style.left="50%",u("game-screen"),I.play(),l.start(),Y(),C(),requestAnimationFrame(D)}function X(){l=d.createOscillator(),l.connect(w),l.type="sawtooth"}function ye(){c="gameover",re.textContent=`Score: ${T.toFixed(2)}`,u("gameover-screen"),_(),l.stop(),A.play(),setTimeout(()=>{V.classList.remove("hidden")},1e3)}W.addEventListener("click",R);se.addEventListener("click",R);window.addEventListener("orientationchange",()=>{setTimeout(C,100)});window.addEventListener("resize",()=>{setTimeout(C,100)});window.addEventListener("deviceorientation",pe);document.addEventListener("DOMContentLoaded",()=>{u("welcome-screen"),typeof DeviceOrientationEvent.requestPermission=="function"&&W.addEventListener("click",async()=>{try{await DeviceOrientationEvent.requestPermission()==="granted"&&R()}catch(e){console.error("Permission denied:",e)}})});
//# sourceMappingURL=index-CZyrRtqf.js.map
