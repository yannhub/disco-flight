(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))s(t);new MutationObserver(t=>{for(const o of t)if(o.type==="childList")for(const E of o.addedNodes)E.tagName==="LINK"&&E.rel==="modulepreload"&&s(E)}).observe(document,{childList:!0,subtree:!0});function b(t){const o={};return t.integrity&&(o.integrity=t.integrity),t.referrerPolicy&&(o.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?o.credentials="include":t.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(t){if(t.ep)return;t.ep=!0;const o=b(t);fetch(t.href,o)}})();const G="/disco-flight/assets/disco-music-4RV96TdM.mp3",R="/disco-flight/assets/explosion-BVY2a1Az.mp3",p=40,q=25,x=5,V=4,k=1500,H=.03,W=-3.5;let c="welcome",h=!1,r=0,L=0,y=0,m=!1,d=null,D=Date.now(),T=0,C=0,O=0,a,i,f;const g=new Audio(G),$=new Audio(R),z=document.getElementById("welcome-screen"),X=document.getElementById("orientation-screen"),I=document.getElementById("game-screen"),Y=document.getElementById("gameover-screen"),F=document.getElementById("gameover-actions"),_=document.getElementById("start-button"),K=document.getElementById("restart-button"),w=document.getElementById("install-button"),v=document.querySelector("#sky-video"),A=document.querySelector("#copilot"),j=document.getElementById("detection-bar"),S=document.createElement("div");S.id="debug-window";S.style.display="none";document.body.appendChild(S);let l;window.addEventListener("beforeinstallprompt",e=>{e.preventDefault(),l=e,w.style.display="block"});w.addEventListener("click",async()=>{if(l){l.prompt();const{outcome:e}=await l.userChoice;e==="accepted"&&console.log("Application installée"),l=null,w.style.display="none"}});window.addEventListener("appinstalled",()=>{console.log("Application installée avec succès"),w.style.display="none",l=null});function u(e){[z,X,I,Y].forEach(n=>{n.classList.add("hidden")}),document.getElementById(e).classList.remove("hidden")}function P(){var e;return window.innerHeight>window.innerWidth?(h=!1,c==="playing"&&(u("orientation-screen"),v.pause(),a&&i.stop()),!1):(h=!0,((e=document.getElementById("orientation-screen"))==null?void 0:e.classList.contains("hidden"))===!1&&(c==="playing"?(u("game-screen"),v.play(),a&&(i=a.createOscillator(),i.connect(f),i.type="sawtooth",i.start()),M(performance.now())):u(c==="welcome"?"welcome-screen":"gameover-screen")),!0)}function J(){const e=y/q*100;j.style.setProperty("--detection-percentage",`${e}%`)}function Q(){if(m){d&&clearTimeout(d),d=window.setTimeout(()=>{N()},x*1e3);return}m=!0,I.classList.add("disco-mode"),g.currentTime=C,g.play()}function N(){m&&(m=!1,I.classList.remove("disco-mode"),C=g.currentTime,g.pause(),d&&(clearTimeout(d),d=null))}function U(){i.frequency.value=100+r/p*50}function Z(){const e=Date.now();e-D>k&&(L=Math.random()*p*2-p,D=e),r+=(L-r)*H}function ee(){const e=Math.abs(r)/p,n=V*e;let s=parseFloat(A.style.left)||50;if(r!==0){const t=r>0?1:-1;s+=t*n}if(T!==0){const t=T/p*W;s-=t}s=Math.max(10,Math.min(90,s)),A.style.left=`${s}%`,(s<=10||s>=90)&&Q()}function M(e){if(c==="playing"&&h){const n=(e-O)/1e3;n>=1/60&&(O=e,Z(),ee(),U(),m&&(y+=n),J(),y>=q&&(c="gameover",oe()),v.style.transform=`rotate(${-r}deg)`),requestAnimationFrame(M)}}function te(e){c==="playing"&&(T=e.beta||0)}function ne(){const e=document.documentElement;e.requestFullscreen&&e.requestFullscreen()}function B(){c="playing",y=0,r=0,L=0,m=!1,O=performance.now(),a=new AudioContext,i=a.createOscillator(),f=a.createGain(),i.connect(f),f.connect(a.destination),i.type="sawtooth",f.gain.value=.1,F.classList.add("hidden"),A.style.left="50%",u("game-screen"),v.play(),i.start(),ne(),P(),requestAnimationFrame(M)}function oe(){c="gameover",u("gameover-screen"),N(),i.stop(),$.play(),setTimeout(()=>{F.classList.remove("hidden")},2e3)}_.addEventListener("click",B);K.addEventListener("click",B);window.addEventListener("orientationchange",()=>{setTimeout(P,100)});window.addEventListener("resize",()=>{setTimeout(P,100)});window.addEventListener("deviceorientation",te);document.addEventListener("DOMContentLoaded",()=>{u("welcome-screen"),typeof DeviceOrientationEvent.requestPermission=="function"&&_.addEventListener("click",async()=>{try{await DeviceOrientationEvent.requestPermission()==="granted"&&B()}catch(e){console.error("Permission denied:",e)}})});
//# sourceMappingURL=index-WRkqu8iv.js.map
