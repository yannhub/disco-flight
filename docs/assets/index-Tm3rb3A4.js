(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))n(t);new MutationObserver(t=>{for(const o of t)if(o.type==="childList")for(const S of o.addedNodes)S.tagName==="LINK"&&S.rel==="modulepreload"&&n(S)}).observe(document,{childList:!0,subtree:!0});function E(t){const o={};return t.integrity&&(o.integrity=t.integrity),t.referrerPolicy&&(o.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?o.credentials="include":t.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(t){if(t.ep)return;t.ep=!0;const o=E(t);fetch(t.href,o)}})();const W="/disco-flight/assets/disco-music-CF8K-ThL.mp3",Y="/disco-flight/assets/explosion-BVY2a1Az.mp3",y=45,G=15,K=3,X=2.5,j=1e3,P=20,N=.01,J=-3,Q=.5;let c="welcome",A=!1,s=0,w=0,M=P,v=0,m=!1,l=null,x=Date.now(),g=0,H=0,f=0,T=0,k=0,L=0,d,r,h;const p=new Audio(W),b=new Audio(Y),U=document.getElementById("welcome-screen"),Z=document.getElementById("orientation-screen"),q=document.getElementById("game-screen"),ee=document.getElementById("gameover-screen"),z=document.getElementById("gameover-actions"),$=document.getElementById("start-button"),te=document.getElementById("restart-button"),O=document.getElementById("install-button"),I=document.querySelector("#sky-video"),F=document.querySelector("#copilot"),ne=document.getElementById("detection-bar"),oe=document.getElementById("time-counter"),ie=document.getElementById("final-score"),B=document.createElement("div");B.id="debug-window";B.style.display="none";document.body.appendChild(B);let a;window.addEventListener("beforeinstallprompt",e=>{e.preventDefault(),a=e,O.style.display="block"});O.addEventListener("click",async()=>{if(a){a.prompt();const{outcome:e}=await a.userChoice;e==="accepted"&&console.log("Application installée"),a=null,O.style.display="none"}});window.addEventListener("appinstalled",()=>{console.log("Application installée avec succès"),O.style.display="none",a=null});function u(e){[U,Z,q,ee].forEach(i=>{i.classList.add("hidden")}),document.getElementById(e).classList.remove("hidden")}function C(){var e;return window.innerHeight>window.innerWidth?(A=!1,c==="playing"&&(u("orientation-screen"),_(),I.pause(),d&&r.stop()),!1):(A=!0,((e=document.getElementById("orientation-screen"))==null?void 0:e.classList.contains("hidden"))===!1&&(c==="playing"?(u("game-screen"),I.play(),d&&(V(),r.start()),f=performance.now(),D(f)):u(c==="welcome"?"welcome-screen":"gameover-screen")),!0)}function se(){m&&(v+=T);const e=v/G*100;ne.style.setProperty("--detection-percentage",`${e}%`)}function ce(){if(navigator.vibrate&&navigator.vibrate(200),m){l&&clearTimeout(l),l=window.setTimeout(()=>{_()},K*1e3);return}m=!0,q.classList.add("disco-mode"),p.currentTime=H,p.play()}function _(){m&&(m=!1,q.classList.remove("disco-mode"),H=p.currentTime,p.pause(),l&&(clearTimeout(l),l=null))}function re(){r.frequency.value=100+s/y*50}function ae(){const e=Date.now();e-x>j&&(w=Math.random()*y*2-y,x=e,M=Math.random()*P+P),Math.abs(w-s)>Q&&(w>s?s+=T*M:s-=T*M),I.style.transform=`rotate(${-s}deg)`}function le(){const e=Math.abs(s)/y,i=X*e;let n=parseFloat(F.style.left)||50;if(s!==0){const t=s>0?1:-1;n+=t*i}if(g!==0){const t=g/y*J;n-=t}n=Math.max(10,Math.min(90,n)),F.style.left=`${n}%`,(n<=13||n>=87)&&ce()}function D(e){c==="playing"&&A&&(T=(e-f)/1e3,f=e,L=(e-k)/100,oe.textContent=L.toFixed(0),ae(),le(),re(),se(),v>=G&&(c="gameover",me()),requestAnimationFrame(D))}function de(e){if(c==="playing"){g=e.beta||0;const i=e.beta||0,E=e.gamma||0,t=Math.atan2(Math.sin(E*Math.PI/180),Math.tan(i*Math.PI/180))*180/Math.PI;g=g*(1-N)+t*N}}function ue(){const e=document.documentElement;e.requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.msRequestFullscreen&&e.msRequestFullscreen()}function R(){c="playing",v=0,s=0,w=0,m=!1,f=performance.now(),k=f,L=0,d=new AudioContext,h=d.createGain(),h.connect(d.destination),h.gain.value=.1,V(),p.play(),p.pause(),b.play(),b.pause(),z.classList.add("hidden"),F.style.left="50%",u("game-screen"),I.play(),r.start(),ue(),C(),requestAnimationFrame(D)}function V(){r=d.createOscillator(),r.connect(h),r.type="sawtooth"}function me(){c="gameover",ie.textContent=`Score: ${L.toFixed(2)}`,u("gameover-screen"),_(),r.stop(),b.play(),setTimeout(()=>{z.classList.remove("hidden")},1e3)}$.addEventListener("click",R);te.addEventListener("click",R);window.addEventListener("orientationchange",()=>{setTimeout(C,100)});window.addEventListener("resize",()=>{setTimeout(C,100)});window.addEventListener("deviceorientation",de);document.addEventListener("DOMContentLoaded",()=>{u("welcome-screen"),typeof DeviceOrientationEvent.requestPermission=="function"&&$.addEventListener("click",async()=>{try{await DeviceOrientationEvent.requestPermission()==="granted"&&R()}catch(e){console.error("Permission denied:",e)}})});
//# sourceMappingURL=index-Tm3rb3A4.js.map
